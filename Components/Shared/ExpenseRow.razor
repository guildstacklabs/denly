@namespace Denly.Components.Shared

<div class="expense-row @(OnClick.HasDelegate ? "clickable" : "")" @onclick="HandleClick">
    <div class="expense-icon-area">
        <div class="expense-icon">
            <span class="expense-initials">@Initials</span>
        </div>
    </div>
    
    <div class="expense-content">
        <div class="expense-title">@Description</div>
        <div class="expense-meta">
            <span>@PayerName added</span>
            @if (!string.IsNullOrEmpty(SplitText))
            {
                <span class="den-chip split-info">@SplitText</span>
            }
            <span class="expense-date">@DateText</span>
        </div>
    </div>
    
    <div class="expense-amount">
        @Amount.ToString("C")
    </div>
</div>

@code {
    [Parameter] public string Description { get; set; } = string.Empty;
    [Parameter] public decimal Amount { get; set; }
    [Parameter] public string PayerName { get; set; } = string.Empty;
    [Parameter] public string SplitText { get; set; } = string.Empty;
    [Parameter] public DateTime Date { get; set; }
    [Parameter] public string? PayerInitials { get; set; }
    [Parameter] public EventCallback OnClick { get; set; }

    private string Initials => !string.IsNullOrWhiteSpace(PayerInitials)
        ? PayerInitials!
        : (!string.IsNullOrWhiteSpace(PayerName) ? PayerName.Trim()[0].ToString().ToUpperInvariant() : "â€¢");

    private string DateText => Date == default ? string.Empty : Date.ToString("MMM d");

    private async Task HandleClick()
    {
        if (OnClick.HasDelegate)
        {
            await OnClick.InvokeAsync();
        }
    }
}
