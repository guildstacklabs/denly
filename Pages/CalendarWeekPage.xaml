<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:shared="clr-namespace:Denly.Components.Shared"
             xmlns:viewmodels="clr-namespace:Denly.ViewModels"
             x:Class="Denly.Pages.CalendarWeekPage"
             Title="Week">
    <!-- Week grid: 7 columns with stacked event blocks -->
    <ScrollView Orientation="Vertical">
        <VerticalStackLayout Padding="{x:Static shared:DesignTokens+Spacing.Xl}" Spacing="12">
            <Label Text="Week"
                   FontSize="{x:Static shared:DesignTokens+Typography.SizeXl}"
                   TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
            <HorizontalStackLayout Spacing="6" IsVisible="{Binding HasUpdates}">
                <shared:UpdatedMark />
                <Label Text="Updated"
                       FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                       TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
            </HorizontalStackLayout>
            <HorizontalStackLayout Spacing="8">
                <Label Text="Filter by child"
                       FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                       TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                <Frame WidthRequest="8"
                       HeightRequest="8"
                       CornerRadius="4"
                       BackgroundColor="{x:Static shared:DesignTokens+Colors.Gold}"
                       IsVisible="{Binding IsFilterActive}"
                       HasShadow="False" />
            </HorizontalStackLayout>
            <CollectionView ItemsSource="{Binding ChildFilters}" ItemsLayout="HorizontalList">
                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodels:ChildFilterItem">
                        <shared:DenChip Text="{Binding Name}"
                                        ChipColor="{Binding ChipColor}">
                            <shared:DenChip.GestureRecognizers>
                                <TapGestureRecognizer Command="{Binding BindingContext.ToggleChildFilterCommand, Source={RelativeSource AncestorType=ContentPage}}"
                                                      CommandParameter="{Binding ChildId}" />
                            </shared:DenChip.GestureRecognizers>
                        </shared:DenChip>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
            <ScrollView Orientation="Horizontal">
                <CollectionView ItemsSource="{Binding WeekDays}" ItemsLayout="HorizontalList">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:WeekDayColumnViewModel">
                            <VerticalStackLayout Spacing="8" WidthRequest="160">
                                <Label Text="{Binding HeaderText}"
                                       FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                                       TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                                <Grid RowSpacing="6">
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <CollectionView ItemsSource="{Binding Events}">
                                        <CollectionView.ItemTemplate>
                                            <DataTemplate x:DataType="viewmodels:WeekEventBlockViewModel">
                                                <Frame Padding="6"
                                                       BackgroundColor="{x:Static shared:DesignTokens+Colors.NookBackground}"
                                                       CornerRadius="8"
                                                       Margin="{Binding LaneMargin}"
                                                       HasShadow="False">
                                                    <Grid ColumnDefinitions="4,*" ColumnSpacing="8">
                                                        <BoxView Color="{Binding AccentColor}" WidthRequest="4" />
                                                        <VerticalStackLayout Grid.Column="1" Spacing="2">
                                                            <HorizontalStackLayout Spacing="6">
                                                                <Label Text="{Binding Title}"
                                                                       FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                                                                       TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                                                                <shared:UpdatedMark IsVisible="{Binding IsUpdated}" />
                                                            </HorizontalStackLayout>
                                                            <shared:ChildMark Text="{Binding ChildSummary}"
                                                                              AccentColor="{Binding AccentColor}" />
                                                            <Label Text="{Binding TimeText}"
                                                                   FontSize="{x:Static shared:DesignTokens+Typography.SizeXs}"
                                                                   TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                                                        </VerticalStackLayout>
                                                    </Grid>
                                                    <Frame.GestureRecognizers>
                                                        <TapGestureRecognizer Command="{Binding BindingContext.SelectEventCommand, Source={RelativeSource AncestorType=ContentPage}}"
                                                                              CommandParameter="{Binding EventId}" />
                                                    </Frame.GestureRecognizers>
                                                </Frame>
                                            </DataTemplate>
                                        </CollectionView.ItemTemplate>
                                    </CollectionView>
                                </Grid>
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </ScrollView>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
