<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:shared="clr-namespace:Denly.Components.Shared"
             xmlns:viewmodels="clr-namespace:Denly.ViewModels"
             x:Class="Denly.Pages.HomeSnapshotPage"
             Title="Home">
    <!-- BindingContext is HomeSnapshotViewModel (set in code-behind) -->
    <ContentPage.Content>
        <ScrollView>
            <VerticalStackLayout Padding="{x:Static shared:DesignTokens+Spacing.Xxl}" Spacing="16">
                <shared:HomeHero WelcomeText="{Binding WelcomeText}"
                                 DateRangeText="{Binding DateRangeText}"
                                 NextEventSummary="{Binding NextEventSummary}"
                                 HasUpdates="{Binding HasUpdates}" />

                <!-- Global Updated indicator -->
                <HorizontalStackLayout Spacing="6" IsVisible="{Binding HasUpdates}">
                    <Frame WidthRequest="8"
                           HeightRequest="8"
                           CornerRadius="4"
                           BackgroundColor="{x:Static shared:DesignTokens+Colors.Coral}"
                           HasShadow="False" />
                    <Label Text="Updated"
                           FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                           TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                </HorizontalStackLayout>

                <!-- Child filter (collapsed by default). Shows indicator when active. -->
                <Grid ColumnDefinitions="Auto,*,Auto" Padding="12" BackgroundColor="{x:Static shared:DesignTokens+Colors.NookBackground}">
                    <Button Text="Filters"
                            Command="{Binding ToggleFilterCommand}"
                            FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                            TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}"
                            BackgroundColor="Transparent" />
                    <Label Grid.Column="1"
                           Text="{Binding FilterSummary}"
                           HorizontalOptions="End"
                           FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                           TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                    <Frame Grid.Column="2"
                           WidthRequest="8"
                           HeightRequest="8"
                           CornerRadius="4"
                           BackgroundColor="{x:Static shared:DesignTokens+Colors.Gold}"
                           IsVisible="{Binding IsFilterActive}"
                           HasShadow="False" />
                </Grid>
                <VerticalStackLayout Padding="12" Spacing="8" IsVisible="{Binding IsFilterExpanded}">
                    <Label Text="Child filter options go here"
                           FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                           TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                </VerticalStackLayout>

                <!-- Day groups (max 4, max 5 events per day - enforced in ViewModel) -->
                <CollectionView ItemsSource="{Binding DayGroups}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:DayGroupViewModel">
                            <VerticalStackLayout Spacing="8" Padding="8">
                                <HorizontalStackLayout Spacing="8">
                                    <Label Text="{Binding DayHeader}"
                                           FontSize="{x:Static shared:DesignTokens+Typography.SizeMd}"
                                           TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                                    <Frame WidthRequest="6"
                                           HeightRequest="6"
                                           CornerRadius="3"
                                           BackgroundColor="{x:Static shared:DesignTokens+Colors.Coral}"
                                           IsVisible="{Binding HasUpdates}"
                                           HasShadow="False" />
                                </HorizontalStackLayout>

                                <CollectionView ItemsSource="{Binding Events}">
                                    <CollectionView.ItemTemplate>
                                        <DataTemplate x:DataType="viewmodels:EventRowViewModel">
                                            <Grid ColumnDefinitions="Auto,*,Auto" Padding="6">
                                                <Label Text="{Binding TimeText}"
                                                       FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                                                       TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                                                <VerticalStackLayout Grid.Column="1" Spacing="2">
                                                    <Label Text="{Binding Title}"
                                                           FontSize="{x:Static shared:DesignTokens+Typography.SizeMd}"
                                                           TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                                                    <Label Text="{Binding Location}"
                                                           FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                                                           TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                                                </VerticalStackLayout>
                                                <Frame Grid.Column="2"
                                                       WidthRequest="6"
                                                       HeightRequest="6"
                                                       CornerRadius="3"
                                                       BackgroundColor="{x:Static shared:DesignTokens+Colors.Coral}"
                                                       IsVisible="{Binding IsUpdated}"
                                                       HasShadow="False" />
                                            </Grid>
                                        </DataTemplate>
                                    </CollectionView.ItemTemplate>
                                </CollectionView>
                            </VerticalStackLayout>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </VerticalStackLayout>
        </ScrollView>
    </ContentPage.Content>
</ContentPage>
