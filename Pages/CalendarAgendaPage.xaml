<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:shared="clr-namespace:Denly.Components.Shared"
             xmlns:viewmodels="clr-namespace:Denly.ViewModels"
             x:Class="Denly.Pages.CalendarAgendaPage"
             Title="Agenda">
    <!-- Agenda: 14-day rolling list grouped by day -->
    <ContentPage.Content>
        <ScrollView>
            <VerticalStackLayout Padding="{x:Static shared:DesignTokens+Spacing.Xl}" Spacing="16">
                <Label Text="Agenda"
                       FontSize="{x:Static shared:DesignTokens+Typography.SizeXl}"
                       TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />

                <!-- Updated legend -->
                <HorizontalStackLayout Spacing="6" IsVisible="{Binding HasUpdates}">
                    <shared:UpdatedMark />
                    <Label Text="Updated"
                           FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                           TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                </HorizontalStackLayout>

                <!-- Persistent child filters -->
                <HorizontalStackLayout Spacing="8">
                    <Label Text="Filter by child"
                           FontSize="{x:Static shared:DesignTokens+Typography.SizeSm}"
                           TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
                    <Frame WidthRequest="8"
                           HeightRequest="8"
                           CornerRadius="4"
                           BackgroundColor="{x:Static shared:DesignTokens+Colors.Gold}"
                           IsVisible="{Binding IsFilterActive}"
                           HasShadow="False" />
                </HorizontalStackLayout>
                <CollectionView ItemsSource="{Binding ChildFilters}" ItemsLayout="HorizontalList">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:ChildFilterItem">
                            <shared:DenChip Text="{Binding Name}"
                                            ChipColor="{Binding ChipColor}">
                                <shared:DenChip.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding BindingContext.ToggleChildFilterCommand, Source={RelativeSource AncestorType=ContentPage}}"
                                                          CommandParameter="{Binding ChildId}" />
                                </shared:DenChip.GestureRecognizers>
                            </shared:DenChip>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <!-- Day groups -->
                <CollectionView ItemsSource="{Binding DayGroups}">
                    <CollectionView.ItemTemplate>
                        <DataTemplate x:DataType="viewmodels:DayGroupViewModel">
                            <shared:DayGroup DayHeader="{Binding DayHeader}"
                                             Events="{Binding Events}"
                                             HasUpdates="{Binding HasUpdates}" />
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>

                <Label Text="{Binding EmptyMessage}" TextColor="{x:Static shared:DesignTokens+Colors.DenShadow}" />
            </VerticalStackLayout>
        </ScrollView>
    </ContentPage.Content>
</ContentPage>
